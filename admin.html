<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Update Feature</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    #adminPanel {
      margin-top: 20px;
      display: none; /* Hidden by default until IP check passes */
    }
    /* A simple style for a "locked" state */
    .locked {
      pointer-events: none;
      opacity: 0.5;
    }
  </style>
</head>
<body>

  <!-- Admin panel: visible only if the visitor's IP is 197.48.128.103 -->
  <div id="adminPanel">
    <h3>Admin Panel - Server Update Feature</h3>
    <textarea id="adminMessage" rows="4" cols="50" placeholder="Type your update here..."></textarea><br>
    <button id="sendMessage">Send Message</button>
    <button id="lockPage">Lock/Unlock Admin Panel</button>
  </div>

  <script>
    // Function to check the client's IP address using a public API.
    function checkIP() {
      fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
          if (data.ip === "197.48.128.103") {
            // Show admin panel if IP matches.
            document.getElementById("adminPanel").style.display = "block";
          }
        })
        .catch(error => {
          console.error("Error fetching IP:", error);
        });
    }

    // Function to update the message in localStorage, which index.html is listening for.
    function sendMessage(newMessage) {
      localStorage.setItem("serverMessage", newMessage);
    }

    // Toggle lock feature for the admin panel.
    let locked = false;
    function toggleLock() {
      locked = !locked;
      const adminPanel = document.getElementById("adminPanel");
      if (locked) {
        adminPanel.classList.add("locked");
      } else {
        adminPanel.classList.remove("locked");
      }
    }

    // Event listener for the "Send Message" button.
    document.getElementById("sendMessage").addEventListener("click", () => {
      const newMessage = document.getElementById("adminMessage").value;
      if (newMessage.trim() !== "") {
        sendMessage(newMessage);
        document.getElementById("adminMessage").value = "";
      }
    });

    // Event listener for the "Lock/Unlock" button.
    document.getElementById("lockPage").addEventListener("click", toggleLock);

    // Initialize by checking the client IP.
    checkIP();
  </script>

</body>
</html>
